"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{1539:function(e,t,s){let a="https://app.sahmk.sa";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=localStorage.getItem("accessToken"),n={"Content-Type":"application/json"};i&&!["signup","signin","refresh"].includes(r)&&(n.Authorization="Bearer ".concat(i));let l={method:t,headers:n};s&&("POST"===t||"PUT"===t)&&(l.body=JSON.stringify(s));let o=async()=>{"DELETE"===t&&delete l.body;let s=await fetch("".concat(a).concat(e),l),r=await s.json();if(s.ok)return{result:r,status:s.status};if(401===s.status&&"token_not_valid"===r.code){let e=localStorage.getItem("refreshToken"),t=await fetch("".concat(a,"/auth/api/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:e})},"refresh"),s=await t.json();if(t.ok)return localStorage.setItem("accessToken",s.access_token),localStorage.setItem("refreshToken",s.refresh_token),i=s.access_token,l.headers.Authorization="Bearer ".concat(i),o()}else throw Error(r.error||"Something went wrong!")};try{return await o()}catch(e){return{error:e.message,status:e.response?e.response.status:null}}}t.Z=r},9572:function(e,t,s){s.r(t),s.d(t,{default:function(){return p}});var a=s(57437),r=s(2265),i=s(16691),n=s.n(i),l=s(9805),o=s(69220),c=e=>{let{onClose:t,setIsOpen:s,isOpen:i,image:n,title:c,messageTitle:d,messageDesc:m,buttonOne:h,buttonTwo:u,buttonIcon:p,actionButton:x,messageType:y}=e;return(0,a.jsx)(l.u.Root,{show:i,as:r.Fragment,children:(0,a.jsxs)(o.V,{as:"div",className:"relative z-10",onClose:t,children:[(0,a.jsx)(l.u.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("div",{className:"fixed inset-0 z-10 w-screen  overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full justify-center text-center items-center p-0",children:(0,a.jsx)(l.u.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)(o.V.Panel,{className:"relative sm:space-y-10 transform rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full w-10/12 sm:max-w-lg sm:p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-auto absolute top-[-100px] left-0 right-0 flex items-center justify-center",children:n}),(0,a.jsxs)("div",{className:"mt-24 text-center",children:[(0,a.jsx)(o.V.Title,{as:"h3",className:"border-b-2 pb-5 border-dashed text-base font-semibold leading-6 text-gray-900 ".concat("success"==y?"text-primaryColor":"error"==y?"text-redColor":""," "),children:c}),(0,a.jsxs)("div",{className:"mt-5",children:[(0,a.jsx)("p",{children:d}),(0,a.jsx)("p",{className:"text-sm mt-3 text-gray-500",children:m})]})]})]}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-6 pt-8 ".concat(!0==x?"sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3":""),children:[(0,a.jsx)("button",{type:"button",className:"inline-flex w-full order-1 justify-center rounded-md bg-secondaryColor px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primaryColor focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primaryColor ",onClick:()=>s(!1),children:h}),!0==x?(0,a.jsxs)("button",{type:"button",className:"mt-3 inline-flex w-full order-2 items-center justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0",onClick:()=>s(!1),children:[u," ",(0,a.jsx)("div",{className:"mr-3",children:p})]}):""]})]})})})})]})})},d=s(82806),m=s(43648),h=s(1539);let u={pricing:{free:{monthly:1,yearly:1},premium:{monthly:1,yearly:1},companies:{monthly:1,yearly:1}}};var p=()=>{let[e,t]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),[l,o]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[y,g]=(0,r.useState)({name:"",phoneNumber:"",email:"",countryCode:"",subscriptionType:"",subscriptionPeriod:"",expirationDate:null});(0,r.useEffect)(()=>{o(window.location.origin)},[]),(0,r.useEffect)(()=>{(async()=>{let e=(await (0,h.Z)("/auth/api/user/")).result;if(e){g({name:e.fullName,phoneNumber:e.phoneNumber,email:e.email,countryCode:e.countryCode,subscriptionType:e.subscriptionType,subscriptionPeriod:e.subscriptionPeriod,expirationDate:e.expirationDate});let t=u.pricing[e.subscriptionType][e.subscriptionPeriod];t&&x(t)}})()},[]),(0,r.useEffect)(()=>{let e=async e=>{let s=await (0,h.Z)("/api/checkout/verify-payment/","POST",{id:e,...y});s&&s.result&&s.result.check?(console.log("Verified payment"),t(!0)):(i(!0),console.log("Verified payment failed"))};{let t=new URL(window.location.href),s=new URLSearchParams(t.search),a=s.get("id"),r=s.get("status"),i=s.get("message");a&&r&&i&&e(a)}},[]);let f=()=>{window.Moyasar.init({element:".mysr-form",amount:100*(p||1),currency:"SAR",description:"Sahmk Purchase",publishable_api_key:"sk_live_nhg2PWy2JCp1xNzXbRCuUWcQysA7u6K7kDt7sM3T",callback_url:"".concat(l,"/payment"),methods:["creditcard","stcpay","applepay"],apple_pay:{country:"SA",label:"Sahmk",validate_merchant_url:"https://api.moyasar.com/v1/applepay/initiate"},credit_card:{save_card:!0},on_completed:function(e){return new Promise(async function(t,s){let a=await (0,h.Z)("/api/checkout/save-payment/","POST",{...e,token:e.source.token});a&&a.result&&a.result.check?t({}):s()})}})};return(0,r.useEffect)(()=>{let e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.moyasar.com/mpf/1.12.0/moyasar.css",document.head.appendChild(e);let t=document.createElement("script");return t.src="https://cdn.moyasar.com/mpf/1.12.0/moyasar.js",t.async=!0,t.onload=()=>{f()},document.head.appendChild(t),()=>{document.head.removeChild(t),document.head.removeChild(e)}},[]),(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsx)(c,{onClose:()=>t(!1),isOpen:e,setIsOpen:t,title:"تم الاشتراك بنجاح",buttonOne:"إدارة حسابي",image:(0,a.jsx)(n(),{src:"/assets/icons/alert-payment-success.svg",height:220,width:220,alt:"image"}),messageTitle:"تم تفعيل باقتك بنجاح \uD83C\uDF89",messageDesc:"يمكنك  الاستفادة من جميع خدمات سهمك",buttonTwo:"ابدأ بمراسلة النظام الذكي",buttonIcon:(0,a.jsx)(n(),{src:"/assets/icons/green-right-arrow.svg",height:15,width:15,alt:"image"}),actionButton:!0,messageType:"success"}):"",s?(0,a.jsx)(c,{onClose:()=>i(!1),isOpen:s,setIsOpen:i,title:"فشلت عملية الدفع!",buttonOne:"حاولة مرة أخرى",image:(0,a.jsx)(n(),{src:"/assets/icons/alert-payment-error.svg",height:220,width:220,alt:"image"}),messageTitle:"فشلت عملية الدفع ",messageDesc:"يمكنك  الاستفادة من جميع خدمات سهمك",actionButton:!1,messageType:"error"}):"",(0,a.jsxs)("div",{className:"mb-20 relative space-y-5",children:[(0,a.jsx)("div",{className:"bg-gray-50 border relative border-gray-300 rounded-2xl px-5 pb-5 pt-5",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-medium text-2xl px-3 mt-2",children:(0,a.jsx)("span",{children:"ملخص الطلب "})}),(0,a.jsx)("div",{className:"bg-white border border-gray-300 rounded-2xl my-5",children:(0,a.jsx)(d.Z,{title:"نوع الباقة",content:(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)(m.Z,{title:"باقة بريميوم",desc:"199 ريال/سنة",descStyle:"text-purpleColor",image:(0,a.jsx)(n(),{src:"/assets/icons/purple-check-icon.svg",height:30,width:30,alt:"image"})})})})}),(0,a.jsx)("div",{className:"bg-white border border-gray-300 rounded-2xl my-5",children:(0,a.jsx)(d.Z,{title:"ملخص الدفع",content:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:"تكلفة الباقة"}),(0,a.jsxs)("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:[p," ريال"]})]})})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center font-medium text-2xl mx-5 my-6 justify-between",children:[(0,a.jsx)("h3",{className:"leading-6 text-gray-900",children:"الإجمالي"}),(0,a.jsxs)("h3",{className:"leading-6 text-gray-900",children:[p," ريال"]})]})})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 border relative border-gray-300 sm:rounded-2xl px-5 pb-20 md:pb-5 ",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-medium text-2xl px-3 mt-6",children:(0,a.jsx)("span",{children:"الدفع"})}),(0,a.jsx)("div",{className:" mt-8",children:(0,a.jsx)("div",{className:"grid gap-6 md:grid-cols-12 border rounded-2xl border-gray-300 bg-white sm:px-8 pt-3 pb-10",children:(0,a.jsx)("div",{className:"mysr-form"})})})]}),(0,a.jsx)(n(),{src:"/assets/images/gradient-bottom.svg",width:170,height:170,className:"absolute -bottom-14 w-[calc(100%-0.75rem)] left-0 right-0 -z-30",alt:"img"})]})]})]})}},43648:function(e,t,s){var a=s(57437);s(2265),t.Z=e=>{let{image:t,title:s,desc:r,descStyle:i}=e;return(0,a.jsx)("div",{children:(0,a.jsx)("div",{href:"#",className:"group block flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{children:t}),(0,a.jsxs)("div",{className:"mr-3 space-y-1",children:[(0,a.jsx)("p",{className:" font-medium text-gray-700 group-hover:text-gray-900",children:s}),(0,a.jsx)("p",{className:"text-xs font-medium text-gray-500 group-hover:text-gray-700 ".concat(i," "),children:r})]})]})})})}},82806:function(e,t,s){var a=s(57437);s(2265),t.Z=e=>{let{title:t,content:s}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"border-b border-gray-200 bg-white px-4 py-4 rounded-t-2xl sm:px-6",children:(0,a.jsx)("h3",{className:"text-base font-semibold leading-6 text-gray-900",children:t})}),(0,a.jsx)("div",{className:"mx-4 sm:mx-6 mt-4 mb-6",children:s})]})}}}]);